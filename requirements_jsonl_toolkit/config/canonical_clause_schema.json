{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://aaci-engine/schemas/canonical_clause_schema.json",
  "title": "CanonicalClause",
  "type": "object",
  "required": [
    "document_id",
    "clause_id",
    "title",
    "source",
    "requirement_type",
    "normative_text",
    "constraints",
    "applicability",
    "evidence_requirements",
    "ambiguity_flags",
    "review_policy"
  ],
  "properties": {
    "document_id": {"type": "string"},
    "document_version": {"type": "string"},
    "clause_id": {"type": "string"},
    "title": {"type": "string"},
    "source": {
      "type": "object",
      "required": ["file", "page"],
      "properties": {
        "file": {"type": "string"},
        "page": {"type": "integer", "minimum": 1},
        "line_start": {"type": "integer", "minimum": 1},
        "line_end": {"type": "integer", "minimum": 1}
      }
    },
    "requirement_type": {
      "type": "string",
      "enum": [
        "numeric_threshold",
        "geometric_relation",
        "categorical_condition",
        "procedural",
        "prohibition",
        "definition"
      ]
    },
    "normative_text": {"type": "string"},
    "constraints": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["field", "operator", "value"],
        "properties": {
          "field": {"type": "string"},
          "operator": {"type": "string", "enum": [">", ">=", "<", "<=", "=", "in", "between", "exists", "not_exists"]},
          "value": {},
          "unit": {"type": "string"},
          "tolerance": {"type": "number"}
        }
      }
    },
    "applicability": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["field", "operator", "value"],
        "properties": {
          "field": {"type": "string"},
          "operator": {"type": "string"},
          "value": {}
        }
      }
    },
    "evidence_requirements": {
      "type": "array",
      "items": {"type": "string"}
    },
    "ambiguity_flags": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["intentional", "linguistic", "tacit_knowledge", "representational"]
      }
    },
    "review_policy": {
      "type": "object",
      "required": ["risk_tier", "auto_decision_allowed"],
      "properties": {
        "risk_tier": {"type": "string", "enum": ["A", "B", "C"]},
        "auto_decision_allowed": {"type": "boolean"},
        "escalation_trigger": {"type": "string"}
      }
    },
    "trace": {
      "type": "object",
      "properties": {
        "parser_version": {"type": "string"},
        "llm_model": {"type": "string"},
        "prompt_version": {"type": "string"},
        "created_at": {"type": "string"}
      }
    }
  }
}
